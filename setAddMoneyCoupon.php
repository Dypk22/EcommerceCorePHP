<?php require 'connection.php'; $uid=$_SESSION['USER_ID']; $coupon=$_POST['couponCode']; $amount=$_POST['amount']; $response=''; $balanceUse=''; if ($coupon!=''){$checkCoupon=mysqli_num_rows(mysqli_query($con,"select * from coupons where code='$coupon' and status=1")); if($checkCoupon>0){$getCoupon=mysqli_fetch_assoc(mysqli_query($con,"select * from coupons where code='$coupon' and status=1")); $isCouponUserAlready=mysqli_num_rows(mysqli_query($con,"select * from wallet where user_id='$uid' and coupon_code='".$getCoupon['code']."'")); $coupon_expiry=$getCoupon['expired_on']; $today_date=date("Y-m-d"); if($today_date>$coupon_expiry){$response="expired coupon";}else{if($getCoupon['status']!=1){$response="not active coupon";}else{if($getCoupon['type1']!='add money'){$response="invalid coupon";}else{if ($getCoupon['min_order_value']>$amount){$response="amount must be greater than â‚¹".$getCoupon['min_order_value'];}else{if ($getCoupon['usage_time']<=$isCouponUserAlready){$response="coupon limit reach";}else{if ($getCoupon['type2']=='percentage'){$discountAmountTemp=round(($getCoupon['value']/100)*$amount); $discountAmount=($discountAmountTemp>$getCoupon['max_discount']) ? $getCoupon['max_discount'] : $discountAmountTemp ;}else{$discountAmount=($getCoupon['value']>$getCoupon['max_discount']) ? $getCoupon['max_discount'] : $getCoupon['value'] ;}$balanceUse=$getCoupon['balance_use']; $response="proceed"; $_SESSION['add_money_coupon']=$coupon; $_SESSION['add_money_coupon_discount']=$discountAmount;}}}}}}else{$response="coupon not exists";}}$data=array('response'=> ucfirst($response), 'balanceUse'=> $balanceUse); header('Content-Type: application/json; charset=utf-8'); echo json_encode($data); ?>